FROM quay.io/bluechi/integration-test-base:latest

RUN dnf install -y dnf-plugin-config-manager

ARG with_coverage

RUN dnf copr enable -y @centos-automotive-sig/bluechi-snapshot

RUN dnf install \
        --nogpgcheck \
        --nodocs \
        bluechi-controller \
        bluechi-controller-debuginfo \
        bluechi-agent \
        bluechi-agent-debuginfo \
        bluechi-ctl \
        bluechi-ctl-debuginfo \
        bluechi-selinux \
        python3-bluechi \
        -y

RUN if [ "$with_coverage" = "1" ]; then \
        dnf install \
        --nogpgcheck \
        --nodocs \
        bluechi-coverage;  \
    fi

RUN dnf -y clean all

CMD [ "/sbin/init" ]
